#!/usr/bin/env python3
"""
–£–ª—É—á—à–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ä–µ–∫–ª–∞–º—ã.
–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —é–º–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ–º–æ–≤.
"""
import logging
import re
import os
import hashlib
from urllib.parse import urlparse
import json

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO,
                    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

# –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
BLOCKED_IMAGES_CACHE = "blocked_images.json"
AD_SIGNATURES_CACHE = "ad_signatures.json"

# –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö—ç—à–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
blocked_image_hashes = set()

# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
ADVERTISING_PATTERNS = {
    "shopping": [
        "–∫—É–ø–∏—Ç—å", "–º–∞–≥–∞–∑–∏–Ω", "—Å–∫–∏–¥–∫", "–∑–∞–∫–∞–∂–∏", "–∑–∞–∫–∞–∂–∏—Ç–µ", "–∑–∞–∫–∞–∑–∞—Ç—å", 
        "–∞–∫—Ü–∏—è", "—Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞", "–±–µ—Å–ø–ª–∞—Ç–Ω", "–¥–µ—à–µ–≤–æ", "–≤—ã–≥–æ–¥–Ω–æ", 
        "—Ä–∞—Å—Å—Ä–æ—á–∫–∞", "—Ä—É–±", "‚ÇΩ", "$", "sale", "shop", "–ø–æ–¥–∞—Ä–æ–∫", "–≤—ã–≥–æ–¥–∞",
        "–±–µ—Å–ø–ª–∞—Ç–Ω–æ", "—Ç–æ–≤–∞—Ä", "–¥–æ—Å—Ç–∞–≤–∫–∞", "–∫—É–ø–æ–Ω", "–ø—Ä–æ–º", "–ø—Ä–æ–º–æ", "promo",
        "–¥–∏—Å–∫–æ–Ω—Ç", "–ø–æ–∫—É–ø–∫", "–∑–∞–∫–∞–∑", "card", "–∫–∞—Ä—Ç–∞", "–±–∞–Ω–∫",
        "–ø—Ä–æ–º–æ–∫–æ–¥", "—Ç–æ–ª—å–∫–æ –¥–æ", "—É—Å–ø–µ–π"
    ],
    "fitness": [
        "—Ç—Ä–µ–Ω–µ—Ä", "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫", "—Ñ–∏—Ç–Ω–µ—Å", "—Å–ø–æ—Ä—Ç–∑–∞–ª", "–≥–∞–Ω—Ç–µ–ª–∏", "gym", 
        "workout", "—Ñ–∏—Ç–æ–Ω—è—à–∫–∞", "—Ç—Ä–µ–Ω–∞–∂–µ—Ä", "–∑–∞–ª", "—É–ø—Ä–∞–∂–Ω–µ–Ω", "–ø—Ä–µ—Å—Å", 
        "—Ñ–∏–≥—É—Ä", "—Ç–µ–ª–æ", "–ø–æ—Ö—É–¥–µ", "–¥–∏–µ—Ç–∞", "exercise", "fitness", 
        "–º—ã—à—Ü—ã", "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏", "—Ç—Ä–µ–Ω–∏—Ä—É–π—Å—è", "–∫–∞—Ä–¥–∏–æ", "–±–∞—Å—Å–µ–π–Ω", "–∞–∫–≤–∞–∞—ç—Ä–æ–±–∏–∫–∞",
        "–π–æ–≥–∞", "—Ä–∞—Å—Ç—è–∂–∫–∞", "–∫—Ä–æ—Å—Å—Ñ–∏—Ç", "crossfit", "–∞–±–æ–Ω–µ–º–µ–Ω—Ç", "stretching"
    ],
    "beauty": [
        "–º–∞–Ω–∏–∫—é—Ä", "–Ω–æ–≥—Ç–∏", "–ø–µ–¥–∏–∫—é—Ä", "—Å–∞–ª–æ–Ω", "nail", "beauty", 
        "–º–∞—Å—Ç–µ—Ä", "–ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä", "—Å—Ç—Ä–∏–∂–∫", "–æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ", "–≤–æ–ª–æ—Å—ã", "hair", "make up", 
        "makeup", "–≤–∏–∑–∞–∂", "–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥", "–º–µ–π–∫–∞–ø", "lash", "lashes", "—Ä–µ—Å–Ω–∏—Ü—ã", 
        "–ø—Ä—è–¥—å", "–ø—Ä–∏—á–µ—Å–∫", "—Å—Ç–∏–ª–∏—Å—Ç", "—ç–ø–∏–ª—è—Ü–∏—è", "–º–∞—Å—Å–∞–∂",
        "–º–æ–ª–æ–¥–æ—Å—Ç—å", "anti-age", "–æ–º–æ–ª–æ–∂–µ–Ω–∏–µ", "spa", "—ç—Å—Ç–µ—Ç–∏–∫"
    ],
    "food_delivery": [
        "–¥–æ—Å—Ç–∞–≤–∫–∞", "—Ä–æ–ª–ª—ã", "—Å—É—à–∏", "–ø–∏—Ü—Ü–∞", "—à–µ—Ñ", "–ø–æ–≤–∞—Ä", "—Ä–µ—Å—Ç–æ—Ä–∞–Ω", "–º–µ–Ω—é", 
        "–∫—É—Ö–Ω—è", "–∫–∞—Ñ–µ", "–µ–¥–∞", "–∑–∞–∫–∞–∑–∞—Ç—å –µ–¥—É", "–±–ª—é–¥–æ", "–≥–æ—Ç–æ–≤–∫–∞", "—Ä–µ—Ü–µ–ø—Ç", 
        "taste", "–≤–∫—É—Å", "sushi", "pizza", "chef", "food", "meal", 
        "–±–∏–∑–Ω–µ—Å-–ª–∞–Ω—á", "–±—É—Ä–≥–µ—Ä", "—Ñ–∞—Å—Ç—Ñ—É–¥", "—ç–∫—Å–ø—Ä–µ—Å—Å-–¥–æ—Å—Ç–∞–≤–∫–∞", 
        "—è–ø–æ–Ω—Å–∫–∞—è –∫—É—Ö–Ω—è", "–∫–∏—Ç–∞–π—Å–∫–∞—è –∫—É—Ö–Ω—è", "–∏—Ç–∞–ª—å—è–Ω—Å–∫–∞—è", "—Å—É—à–∏ —Å–µ—Ç", "—Ä–æ–ª–ª—ã —Å–µ—Ç",
        "—É–≥–æ—Ä—å", "–ª–æ—Å–æ—Å—å", "–¥–µ–ª–∏–∫–∞—Ç–µ—Å", "–≥–∞—Å—Ç—Ä–æ–Ω–æ–º", "–≤–æ–∫", "wok"
    ],
    "clothing": [
        "–æ–¥–µ–∂–¥–∞", "–æ–±—É–≤—å", "–ø–ª–∞—Ç—å–µ", "—Ñ—É—Ç–±–æ–ª–∫–∞", "–¥–∂–∏–Ω—Å—ã", "—é–±–∫–∞", 
        "–∫—É—Ä—Ç–∫–∞", "–ø–∞–ª—å—Ç–æ", "—à—É–±–∞", "—Å—É–º–∫–∞", "–∞–∫—Å–µ—Å—Å—É–∞—Ä", "fashion", "–º–æ–¥–∞", 
        "–±—Ä–µ–Ω–¥", "brand", "–∫–æ–ª–ª–µ–∫—Ü–∏—è", "clothes", "wear", 
        "–Ω–∞—Ä—è–¥", "–æ–±—Ä–∞–∑", "–ª—É–∫", "look", "shopping", 
        "—à–æ–ø–ø–∏–Ω–≥", "—Ç—Ä–µ–Ω–¥", "—Ç—Ä–µ–Ω–¥—ã", "–∞—É—Ç–ª–µ—Ç", "outlet", "sale", "—Å–µ–∑–æ–Ω"
    ],
    "real_estate": [
        "–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å", "–∫–≤–∞—Ä—Ç–∏—Ä–∞", "—É—á–∞—Å—Ç–æ–∫", "–ø–æ–º–µ—â–µ–Ω–∏–µ", 
        "–∞—Ä–µ–Ω–¥–∞", "—Å–¥–∞–º", "—Å–¥–∞—é", "—Å–Ω–∏–º—É", "–ø—Ä–æ–¥–∞–º", "–ø—Ä–æ–¥–∞—é", "—Ä–∏—ç–ª—Ç–æ—Ä", 
        "–∑–∞—Å—Ç—Ä–æ–π—â–∏–∫", "–Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞", "—Ä–µ–º–æ–Ω—Ç", "–æ—Ç–¥–µ–ª–∫–∞", "–∏–ø–æ—Ç–µ–∫–∞", "–∫—Ä–µ–¥–∏—Ç", 
        "—Ä–∞—Å—Å—Ä–æ—á–∫–∞", "–∂–∏–ª–æ–π –∫–æ–º–ø–ª–µ–∫—Å", "–∂–∫", "–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã", "—Å—Ç—É–¥–∏—è",
        "real estate", "property", "flat", "rent", "mortgage", "credit"
    ],
    "education": [
        "–∫—É—Ä—Å—ã", "–æ–±—É—á–µ–Ω–∏–µ", "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "—Ç—Ä–µ–Ω–∏–Ω–≥", "—Å–µ–º–∏–Ω–∞—Ä", "–≤–µ–±–∏–Ω–∞—Ä", 
        "–º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å", "–º–∫", "school", "–∏–Ω—Å—Ç–∏—Ç—É—Ç", "—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", 
        "–∫–æ–ª–ª–µ–¥–∂", "–∞–∫–∞–¥–µ–º–∏—è", "–Ω–∞–±–æ—Ä", "–ø—Ä–µ–ø–æ–¥", "—É—á–∏—Ç–µ–ª—å", "—É—á–µ–Ω–∏–∫", 
        "—Å—Ç—É–¥–µ–Ω—Ç", "–æ–Ω–ª–∞–π–Ω –∫—É—Ä—Å", "–¥–∏–ø–ª–æ–º", "—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"
    ],
    "travel": [
        "–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ", "–æ—Ç–¥—ã—Ö", "–æ—Ç–µ–ª—å", "–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞", "–±–∏–ª–µ—Ç—ã", "–∞–≤–∏–∞", 
        "—Å–∞–º–æ–ª–µ—Ç", "–ø–æ–µ–∑–¥", "–∫—Ä—É–∏–∑", "—ç–∫—Å–∫—É—Ä—Å–∏—è", "travel", "trip", "–∫—É—Ä–æ—Ä—Ç", 
        "–º–æ—Ä–µ", "–≥–æ—Ä—ã", "–ø–ª—è–∂", "beach", "sea", "–≥–æ—Ä—è—â–∏–µ —Ç—É—Ä—ã", "last minute", 
        "–≤–∏–∑–∞", "–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "booking", "all inclusive"
    ],
    "events": [
        "–∫–æ–Ω—Ü–µ—Ä—Ç", "—Ñ–µ—Å—Ç–∏–≤–∞–ª—å", "—à–æ—É", "–≤—ã—Å—Ç–∞–≤–∫–∞", "—Å–ø–µ–∫—Ç–∞–∫–ª—å", "–∫–∏–Ω–æ", "—Ç–µ–∞—Ç—Ä", 
        "–±–∏–ª–µ—Ç—ã", "–∞—Ñ–∏—à–∞", "event", "–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ", "–≤–µ—á–µ—Ä–∏–Ω–∫–∞", "party", 
        "–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è", "–ø—Ä–µ–º—å–µ—Ä–∞", "–æ—Ç–∫—Ä—ã—Ç–∏–µ", "–≥–∞–ª–∞", "—Ü–µ—Ä–µ–º–æ–Ω–∏—è", "–ø—Ä–∞–∑–¥–Ω–∏–∫"
    ]
}

# –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —à–∞–±–ª–æ–Ω—ã –≤ –æ–¥–∏–Ω —Å–ø–∏—Å–æ–∫
ALL_BLOCKED_PATTERNS = []
for category, patterns in ADVERTISING_PATTERNS.items():
    ALL_BLOCKED_PATTERNS.extend(patterns)
ALL_BLOCKED_PATTERNS = list(set(ALL_BLOCKED_PATTERNS))

# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É
SPECIFIC_BLOCKED_IMAGES = [
    "—Ç—Ä–µ–Ω–∏—Ä—É–π—Å—è-–≤–º–µ—Å—Ç–µ-—Å-–Ω–∞–º–∏", "train-with-us", "fitness-promo", "workout-ad",
    "—Ñ–∏—Ç–Ω–µ—Å-–∫–ª—É–±", "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞", "–≥–∞–Ω—Ç–µ–ª–∏", "fitness", "dumbbells", "exercise",
    "new-year-fitness", "–Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π-—Ñ–∏—Ç–Ω–µ—Å", "pink-dumbbells", "—Ä–æ–∑–æ–≤—ã–µ-–≥–∞–Ω—Ç–µ–ª–∏",
    "irina-emelyanova", "emelyanova-nail", "nail-artist", "–º–∞–Ω–∏–∫—é—Ä-–º–∞—Å—Ç–µ—Ä",
    "beauty-salon", "—Å–∞–ª–æ–Ω-–∫—Ä–∞—Å–æ—Ç—ã", "–º–∞–Ω–∏–∫—é—Ä", "–Ω–æ–≥—Ç–∏", "nail-design", "nail-art",
    "–¥–æ—Å—Ç–∞–≤–∫–∞-—Ä–æ–ª–ª–æ–≤", "sushi-delivery", "—á—Ç–æ—Ä—Ä—É", "–¥–æ—Å—Ç–∞–≤–∫–∞-—Å—É—à–∏", "—Å—É—à–∏-–¥–æ—Å—Ç–∞–≤–∫–∞",
    "—Ä–æ–ª–ª—ã-–¥–æ—Å—Ç–∞–≤–∫–∞", "–¥–æ—Å—Ç–∞–≤–∫–∞-–ø–∏—Ü—Ü—ã", "–¥–æ—Å—Ç–∞–≤–∫–∞-–µ–¥—ã", "–µ–¥–∞-–Ω–∞-–¥–æ–º", 
    "—Ä—ã–±–∞-–ø–æ–≤–∞—Ä", "—Ä—ã–±–∞-—à–µ—Ñ", "fish-chef", "chef-sushi",
    "reklama", "—Ä–µ–∫–ª–∞–º–∞", "ad-", "advert-"
]

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
EXTENDED_MARKERS = {
    "fitness": [
        "—Ä–æ–∑–æ–≤—ã–µ –≥–∞–Ω—Ç–µ–ª–∏", "–Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π", "—Ñ–∏—Ç–Ω–µ—Å", "—Å–ø–æ—Ä—Ç–∑–∞–ª", "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞",
        "—Ç—Ä–µ–Ω–∞–∂–µ—Ä", "—Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª", "–∞–±–æ–Ω–µ–º–µ–Ω—Ç", "–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä",
        "–≥—Ä—É–ø–ø–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏", "–∫—Ä–æ—Å—Å—Ñ–∏—Ç", "–∫–∞—Ä–¥–∏–æ", "—Å–∏–ª–æ–≤—ã–µ", "stretching"
    ],
    "nail_art": [
        "—Ä–æ–∑–æ–≤—ã–π —Ñ–æ–Ω", "–µ–º–µ–ª—å—è–Ω–æ–≤–∞", "–º–∞–Ω–∏–∫—é—Ä", "nail artist", "irina",
        "–¥–∏–∑–∞–π–Ω –Ω–æ–≥—Ç–µ–π", "nail master", "–º–∞—Å—Ç–µ—Ä –Ω–æ–≥—Ç–µ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞", "–ø–µ–¥–∏–∫—é—Ä",
        "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π", "–≥–µ–ª—å-–ª–∞–∫", "shellac", "—à–µ–ª–ª–∞–∫", "–º–∞–Ω–∏–∫—é—Ä–Ω—ã–π —Å–∞–ª–æ–Ω"
    ],
    "food_delivery": [
        "—Ä—ã–±–∞", "—à–µ—Ñ", "–ø–æ–≤–∞—Ä", "—Ä–æ–ª–ª—ã", "—Å—É—à–∏", "–¥–æ—Å—Ç–∞–≤–∫–∞", "—É–≥–æ—Ä—å", "—á—Ç–æ—Ä—Ä—É",
        "–ø–∏—Ü—Ü–∞", "–µ–¥–∞ –Ω–∞ –¥–æ–º", "—Å–∫–∏–¥–∫–∞ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É", "–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
        "—è–ø–æ–Ω—Å–∫–∞—è –∫—É—Ö–Ω—è", "–∫–∏—Ç–∞–π—Å–∫–∞—è –∫—É—Ö–Ω—è", "–µ–≤—Ä–æ–ø–µ–π—Å–∫–∞—è –∫—É—Ö–Ω—è", "–∏—Ç–∞–ª—å—è–Ω—Å–∫–∞—è"
    ],
    "clothing": [
        "–Ω–æ–≤–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è", "—Å–∫–∏–¥–∫–∏ –¥–æ", "—Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞", "sale", "–º–æ–¥–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã",
        "—Å—Ç–∏–ª—å–Ω—ã–µ", "–±—Ä–µ–Ω–¥", "–¥–∏–∑–∞–π–Ω–µ—Ä", "–æ–¥–µ–∂–¥–∞", "–æ–±—É–≤—å", "–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã",
        "—Å—É–º–∫–∏", "–ø–ª–∞—Ç—å—è", "–∫–æ—Å—Ç—é–º—ã", "premium", "–ª—é–∫—Å", "outlet"
    ],
    "real_estate": [
        "–Ω–æ–≤—ã–π –∂–∏–ª–æ–π –∫–æ–º–ø–ª–µ–∫—Å", "–∫–≤–∞—Ä—Ç–∏—Ä—ã –æ—Ç –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–∞", "–∏–ø–æ—Ç–µ–∫–∞", "—Ä–∞—Å—Å—Ä–æ—á–∫–∞",
        "–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å", "–Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞", "–∂–∏–ª–æ–π –∫–æ–º–ø–ª–µ–∫—Å", "–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã",
        "–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å", "–æ—Ñ–∏—Å—ã", "–≤—ã–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è", "—Å–∫–∏–¥–∫–∞"
    ]
}

def load_blocked_lists():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–æ–≤"""
    global blocked_image_hashes
    try:
        if os.path.exists(BLOCKED_IMAGES_CACHE):
            with open(BLOCKED_IMAGES_CACHE, 'r', encoding='utf-8') as f:
                loaded_hashes = json.load(f)
                if loaded_hashes and isinstance(loaded_hashes, list):
                    blocked_image_hashes = set(loaded_hashes)
                    logger.info(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(blocked_image_hashes)} —Ö—ç—à–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤: {e}")

def save_blocked_lists():
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–ø–∏—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ —Ñ–∞–π–ª—ã"""
    try:
        with open(BLOCKED_IMAGES_CACHE, 'w', encoding='utf-8') as f:
            json.dump(list(blocked_image_hashes), f, ensure_ascii=False, indent=2)
        logger.info(f"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {len(blocked_image_hashes)} —Ö—ç—à–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤: {e}")

def compute_image_hash(image_url):
    """–í—ã—á–∏—Å–ª—è–µ—Ç —Ö—ç—à –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ URL"""
    return hashlib.md5(image_url.encode()).hexdigest()

def add_blocked_image(image_url):
    """–î–æ–±–∞–≤–ª—è–µ—Ç URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö"""
    if not image_url:
        return
    image_hash = compute_image_hash(image_url)
    blocked_image_hashes.add(image_hash)
    save_blocked_lists()
    logger.info(f"–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: {image_url[:50]}...")

def is_blocked_image(image_url):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ URL"""
    if not image_url:
        return False
    image_hash = compute_image_hash(image_url)
    return image_hash in blocked_image_hashes

def detect_advertisement_in_text(text):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (bool, str) - (–Ω–∞–π–¥–µ–Ω–∞ —Ä–µ–∫–ª–∞–º–∞?, –ø—Ä–∏—á–∏–Ω–∞)
    """
    if not text:
        return False, ""
    
    text = text.lower()
    for pattern in ALL_BLOCKED_PATTERNS:
        if pattern in text:
            return True, f"–Ω–∞–π–¥–µ–Ω–æ —Ä–µ–∫–ª–∞–º–Ω–æ–µ —Å–ª–æ–≤–æ '{pattern}'"
    
    ad_regexes = [
        r'\d+\s*%', r'—Å–∫–∏–¥–∫[–∞–∏—É]?\s+–¥–æ\s+\d+', r'–¥–æ\s+-\d+\s*%',
        r'–æ—Ç\s+\d+\s*—Ä—É–±', r'–≤—Å–µ–≥–æ\s+\d+\s*—Ä—É–±', r'–≤—Å–µ–≥–æ\s+–∑–∞\s+\d+',
        r'—Ü–µ–Ω–∞\s*:?\s*\d+', r'—Å—Ç–æ–∏–º–æ—Å—Ç—å\s*:?\s*\d+', r'—Ä—É–±\.|‚ÇΩ',
        r'–∑–≤–æ–Ω–∏[—Ç–µ]?', r'–ø–∏—à–∏[—Ç–µ]?', r'–∑–∞—Ö–æ–¥–∏[—Ç–µ]?', r'–ø—Ä–∏—Ö–æ–¥–∏[—Ç–µ]?',
        r'—Å–ø–µ—à–∏[—Ç–µ]?', r'—É—Å–ø–µ–π[—Ç–µ]?', r'–∑–∞–∫–∞–∂–∏[—Ç–µ]?', r'–ø—Ä–µ–¥–ª–æ–∂[–µ–∏]–Ω–∏[–µ—è]',
        r'–≤—ã–≥–æ–¥–Ω[—ã–æ–µ–∞—è]', r'–ø–æ–¥—Ä–æ–±–Ω[–µ–µ]?',
        r'\+7\s*\(\d{3}\)\s*\d{3}[-\s]?\d{2}[-\s]?\d{2}',
        r'8\s*\d{3}[-\s]?\d{3}[-\s]?\d{2}[-\s]?\d{2}',
        r'—Ç–µ–ª[\.\:]', r'–∫–æ–Ω—Ç–∞–∫—Ç—ã\s*:',
        r'https?:\/\/', r'www\.', r'\.ru|\.com|\.net|\.org',
        r'–æ–Ω–ª–∞–π–Ω', r'–æ—Ñ+–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç', r'–ø–æ–¥–ø–∏—Å—ã–≤–∞[–µ—è]—Ç–µ—Å—å',
        r'–∑–∞–∫–∞–∑[–∞—Ç]—å\s+–Ω–∞\s+—Å–∞–π—Ç–µ', r'–∞–∫—Ü–∏[—è–∏]', r'—Å–∫–∏–¥–∫[–∏–∞]',
        r'—Ä–∞—Å–ø—Ä–æ–¥–∞–∂[–∞–∏]', r'—Å–ø–µ—Ü\.?\s*–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏[–µ—è]',
        r'–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ', r'—Ç–æ–ª—å–∫–æ\s+(—Å–µ–≥–æ–¥–Ω—è|–∑–∞–≤—Ç—Ä–∞|–¥–æ\s+\d+)',
        r'–¥–µ–π—Ç—Å–≤—É[–µ—é—è]—Ç\s+–¥–æ', r'–∑–∞–ø–∏—Å—ã–≤–∞[–µ–π]—Ç–µ—Å—å',
        r'–ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏\s+(–ø–æ\s+—Ç–µ–ª–µ—Ñ–æ–Ω—É|–Ω–∞\s+—Å–∞–π—Ç–µ)',
        r'üí∞|üí≤|üí∏|üíµ|üí¥|üí∂|üí∑|üè∑Ô∏è|üè∑|üîñ|üìù|üì≤|üì±|üìû|‚òéÔ∏è|üìß|‚úâÔ∏è|üõí|üõçÔ∏è|üõç|üéÅ'
    ]
    
    for regex in ad_regexes:
        if re.search(regex, text, re.IGNORECASE):
            return True, f"–Ω–∞–π–¥–µ–Ω —Ä–µ–∫–ª–∞–º–Ω—ã–π —à–∞–±–ª–æ–Ω '{regex}'"
    
    return False, ""

def detect_advertisement_in_url(url):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç URL –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (bool, str) - (–Ω–∞–π–¥–µ–Ω–∞ —Ä–µ–∫–ª–∞–º–∞?, –ø—Ä–∏—á–∏–Ω–∞)
    """
    if not url:
        return False, ""
    
    url = url.lower()
    for specific_image in SPECIFIC_BLOCKED_IMAGES:
        if specific_image in url:
            return True, f"URL —Å–æ–¥–µ—Ä–∂–∏—Ç –±–ª–æ–∫–∏—Ä—É–µ–º—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: {specific_image}"
    
    if is_blocked_image(url):
        return True, "URL –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"
    
    parsed_url = urlparse(url)
    domain_path = (parsed_url.netloc + parsed_url.path).lower()
    for pattern in ALL_BLOCKED_PATTERNS:
        if pattern in domain_path:
            return True, f"URL —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∫–ª–∞–º–Ω–æ–µ —Å–ª–æ–≤–æ: {pattern}"
    
    return False, ""

def detect_ad_category(item_data):
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä–µ–∫–ª–∞–º—ã
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (–∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–ª–∏ None, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å 0-100)
    """
    if not item_data:
        return None, 0
    
    text = item_data.get("text", "").lower()
    image_url = item_data.get("image_url", "").lower()
    category_scores = {}
    
    for category, patterns in ADVERTISING_PATTERNS.items():
        score = 0
        for pattern in patterns:
            if pattern in text:
                score += 10
            if pattern in image_url:
                score += 5
        if category in EXTENDED_MARKERS:
            for marker in EXTENDED_MARKERS[category]:
                if marker in text:
                    score += 15
                if marker in image_url:
                    score += 5
        category_scores[category] = score
    
    max_category = max(category_scores.items(), key=lambda x: x[1], default=(None, 0))
    if max_category[1] >= 10:
        return max_category[0], min(max_category[1], 100)
    return None, 0

def check_for_specific_ad_content(image_url, text=None):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (bool, str) - (—è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∫–ª–∞–º–Ω—ã–º?, –ø—Ä–∏—á–∏–Ω–∞)
    """
    if not image_url and not text:
        return False, ""
    
    url = image_url.lower() if image_url else ""
    text = text.lower() if text else ""
    
    for category, markers in EXTENDED_MARKERS.items():
        for marker in markers:
            if marker in url or marker in text:
                return True, f"–æ–±–Ω–∞—Ä—É–∂–µ–Ω –º–∞—Ä–∫–µ—Ä —Ä–µ–∫–ª–∞–º—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ '{category}': {marker}"
    
    return False, ""

def is_suitable_meme_advanced(meme, strict_mode=True):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –º–µ–º –¥–ª—è –ø–æ–∫–∞–∑–∞. –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ—Ç —Ä–µ–∫–ª–∞–º—É, –Ω–æ –¥–æ–ø—É—Å–∫–∞–µ—Ç –º–µ–º—ã –±–µ–∑ —Å—Ç—Ä–æ–≥–æ–π –æ—Ñ–∏—Å–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–∏.
    
    Args:
        meme (dict): –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–µ–º–µ (image_url, text, tags, source, timestamp)
        strict_mode (bool): –ï—Å–ª–∏ True, –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Å—Ç—Ä–æ–≥—É—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –ø–æ –æ—Ñ–∏—Å–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–µ
    
    Returns:
        bool: True –µ—Å–ª–∏ –º–µ–º –ø–æ–¥—Ö–æ–¥–∏—Ç, False –µ—Å–ª–∏ –Ω–µ—Ç
    """
    if not blocked_image_hashes:
        load_blocked_lists()
    
    try:
        image_url = meme.get("image_url", "").lower()
        text = meme.get("text", "").lower()
        tags = meme.get("tags", []) if isinstance(meme.get("tags"), list) else []
        source = meme.get("source", "").lower()

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –º–µ–º–∞
        if not image_url and not text:
            logger.info("–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Ç–µ–∫—Å—Ç")
            return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
        religious_keywords = [
            "—Ö—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫", "—Å–ª—É–∂–µ–Ω–∏", "–ø—Ä–∞–≤–æ—Å–ª–∞–≤", "–º–æ–ª–∏—Ç–≤", "—Ü–µ—Ä–∫–æ–≤—å", "—Ö—Ä–∞–º",
            "–±–æ–≥", "–≥–æ—Å–ø–æ–¥", "–≤–µ—Ä–∞", "–¥—É—Ö–æ–≤–Ω", "—Ä–µ–ª–∏–≥–∏", "—Å–≤—è—Ç–æ–π", "—Å–≤—è—â–µ–Ω–Ω–∏–∫",
            "–ø—Ä–æ–ø–æ–≤–µ–¥", "–±–∏–±–ª–∏", "–∫—Ä–µ—â–µ–Ω–∏", "–≥—Ä–µ—Ö", "–∏—Å–ø–æ–≤–µ–¥", "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω–∏",
            "—Ü–µ—Ä–µ–º–æ–Ω–∏", "—Ä–∏—Ç—É–∞–ª", "–ø–æ–∫–ª–æ–Ω–µ–Ω–∏", "–ø–∞—Ç—Ä–∏–∞—Ä—Ö", "–º–æ–Ω–∞—Å—Ç—ã", "–º–æ–Ω–∞—Ö"
        ]
        for keyword in religious_keywords:
            if keyword in text:
                logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—É—é —Ç–µ–º–∞—Ç–∏–∫—É ('{keyword}')")
                return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–∞—Ç—É–∏—Ä–æ–≤–∫–∏
        tattoo_keywords = ["—Ç–∞—Ç—É", "—Ç–∞—Ç—É–∏—Ä–æ–≤–∫", "—Ç–∞—Ç—É—Ö–∞", "–Ω–∞–±–∏—Ç", "–Ω–∞–±–∏–≤–∞—Ç—å"]
        for keyword in tattoo_keywords:
            if keyword in text:
                logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: —Å–æ–¥–µ—Ä–∂–∏—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ç–∞—Ç—É–∏—Ä–æ–≤–æ–∫")
                return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
        is_ad, reason = check_for_specific_ad_content(image_url, text)
        if is_ad:
            logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: {reason}")
            add_blocked_image(image_url)
            return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ —Ä–µ–∫–ª–∞–º—É
        is_ad, reason = detect_advertisement_in_text(text)
        if is_ad:
            logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ —Ç–µ–∫—Å—Ç—É: {reason}")
            add_blocked_image(image_url)
            return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ URL –Ω–∞ —Ä–µ–∫–ª–∞–º—É
        if image_url:
            is_ad, reason = detect_advertisement_in_url(image_url)
            if is_ad:
                logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ URL: {reason}")
                add_blocked_image(image_url)
                return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª—é—Ç–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
        currency_symbols = ["‚ÇΩ", "$", "‚Ç¨", "—Ä—É–±", "—Ä—É–±–ª", "dollar", "–¥–æ–ª–ª–∞—Ä", "–µ–≤—Ä–æ"]
        if any(symbol in text for symbol in currency_symbols):
            logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–º–≤–æ–ª—ã –≤–∞–ª—é—Ç/–¥–µ–Ω–µ–≥")
            add_blocked_image(image_url)
            return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–≥–æ–≤
        allowed_tags = ["–º–µ–º", "—é–º–æ—Ä", "–æ—Ñ–∏—Å", "—Ä–∞–±–æ—Ç–∞", "–±–æ—Å—Å", "–Ω–∞—á–∞–ª—å–Ω–∏–∫", "–∫–æ–ª–ª–µ–≥–∏", "—Å–æ—Ç—Ä—É–¥–Ω–∏–∫"]
        for tag in tags:
            tag_text = tag.lower()
            if tag_text in allowed_tags:
                continue
            is_ad, reason = detect_advertisement_in_text(tag_text)
            if is_ad:
                logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ —Ç–µ–≥—É: {tag} ({reason})")
                add_blocked_image(image_url)
                return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
        if "metadata" in meme and isinstance(meme["metadata"], dict):
            metadata = meme["metadata"]
            for field in ["title", "description"]:
                if field in metadata and metadata[field]:
                    is_ad, reason = detect_advertisement_in_text(metadata[field].lower())
                    if is_ad:
                        logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ {field} –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö: {reason}")
                        add_blocked_image(image_url)
                        return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–µ–∫–ª–∞–º—ã
        ad_category, confidence = detect_ad_category(meme)
        if ad_category and confidence > 20:
            logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: –ø–æ—Ö–æ–∂ –Ω–∞ —Ä–µ–∫–ª–∞–º—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ '{ad_category}' —Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é {confidence}%")
            add_blocked_image(image_url)
            return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–º–∏—Å—è —Å–ª–æ–≤–∞–º–∏
        if text and len(text.split()) > 50:
            words = text.split()
            word_count = {}
            for word in words:
                if len(word) > 3:
                    word_count[word] = word_count.get(word, 0) + 1
            for word, count in word_count.items():
                if count > 3:  # –°–Ω–∏–∑–∏–ª–∏ –ø–æ—Ä–æ–≥ —Å 5 –¥–æ 3
                    logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è —Å–ª–æ–≤–æ '{word}' ({count} —Ä–∞–∑)")
                    add_blocked_image(image_url)
                    return False

        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ—Ñ–∏—Å–Ω—É—é —Ç–µ–º–∞—Ç–∏–∫—É (—Ç–æ–ª—å–∫–æ –≤ —Å—Ç—Ä–æ–≥–æ–º —Ä–µ–∂–∏–º–µ)
        if strict_mode:
            office_keywords = [
                "–æ—Ñ–∏—Å", "—Ä–∞–±–æ—Ç–∞", "–±–æ—Å—Å", "–Ω–∞—á–∞–ª—å–Ω–∏–∫", "–∫–æ–ª–ª–µ–≥–∞", "–∫–æ–ª–ª–µ–≥–∏", 
                "—Å–æ—Ç—Ä—É–¥–Ω–∏–∫", "–ø—Ä–æ–µ–∫—Ç", "–æ—Ç–ø—É—Å–∫", "–∑–∞—Ä–ø–ª–∞—Ç–∞", "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
                "—Å–æ–≤–µ—â–∞–Ω–∏–µ", "—Å–æ–±—Ä–∞–Ω–∏–µ", "–¥–µ–¥–ª–∞–π–Ω", "—Å—Ä–æ–∫", "–ø—è—Ç–Ω–∏—Ü–∞", "–≤—ã—Ö–æ–¥–Ω–æ–π",
                "—á–∞—Ç", "–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤", "–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è", "–æ—Ç—á–µ—Ç", "–∫–æ—Ñ–µ", "–ø–µ—Ä–µ—Ä—ã–≤",
                "–∫–∞–±–∏–Ω–µ—Ç", "—Å—Ç–æ–ª", "–∫–æ–º–ø—å—é—Ç–µ—Ä", "–¥–æ–∫—É–º–µ–Ω—Ç", "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç",
                "–º–µ–Ω–µ–¥–∂–µ—Ä", "–æ—Ç–¥–µ–ª", "—É–≤–æ–ª—å–Ω–µ–Ω–∏–µ", "—Å—Ç–∞–≤–∫–∞", "—Ä–µ–∑—é–º–µ", "–≤–∞–∫–∞–Ω—Å–∏—è",
                "–¥–æ–ª–∂–Ω–æ—Å—Ç—å", "–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å", "–±—É–¥–∏–ª—å–Ω–∏–∫",
                "–æ–ø–æ–∑–¥–∞–Ω–∏–µ", "–æ–±–µ–¥", "–æ–±–µ–¥–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ä—ã–≤", "–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞", "–∫–æ–º–∞–Ω–¥–∞",
                "–±–∏–∑–Ω–µ—Å", "–∫–ª–∏–µ–Ω—Ç", "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å", "–¥–∏—Ä–µ–∫—Ç–æ—Ä", "–∑–∞–¥–∞—á–∞", "–ø—Ä–∏–∫–∞–∑",
                "—Ñ–∏–Ω–∞–Ω—Å—ã", "–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã", "—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ", "—Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å", "—Å–º–µ–Ω–∞", "–±—É—Ö–≥–∞–ª—Ç–µ—Ä"
            ]
            work_keywords = [
                "—Ä–∞–±–æ—Ç–∞—Ç—å", "—Ç—Ä—É–¥–∏—Ç—å—Å—è", "—Ä–∞–±–æ—Ç–∞—é", "—Ä–∞–±–æ—Ç–∞–µ–º", "–¥–æ–º–æ–π", "—Å–∏–∂—É", "—Å–∏–¥–∏–º",
                "—Ä–∞–±–æ—á–∏–π", "–æ—Ñ–∏—Å–Ω—ã–π", "—É—Å—Ç–∞–ª", "–Ω–µ –≤—ã—Å–ø–∞–ª—Å—è", "–∫–æ–º–ø–∞–Ω–∏—è", "–∫–æ—Ä–ø–æ—Ä–∞—Ü–∏—è",
                "—Ñ–∏—Ä–º–∞", "–∑–∞—Ä–ø–ª–∞—Ç—É", "–ø–æ–≤—ã—à–µ–Ω–∏–µ", "–∞–≤–∞–Ω—Å", "–ø—Ä–µ–º–∏—è", "–æ—Ç–≥—É–ª", "–≤—ã–≥–æ–≤–æ—Ä", 
                "–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã", "–±—É–º–∞–≥–∏", "–ø—Ä–∏–¥—É–º–∞—Ç—å", "—É—Å–ø–µ—Ç—å", "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å", "–ø—Ä–∏—ë–º", 
                "–ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å", "–∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞", "–∑–≤–æ–Ω–æ–∫", "–≥—Ä–∞—Ñ–∏–∫", "–ø–æ—á—Ç–∞", "email",
                "–≤—ã—Ö–æ–¥–Ω—ã–µ", "–±—É–¥–Ω–∏", "—Å—Ç—Ä–µ—Å—Å", "–ø—Ä–æ—Ñ–µ—Å—Å–∏—è", "–∫–∞—Ä—å–µ—Ä–∞"
            ]
            is_office_related = any(keyword in text for keyword in office_keywords + work_keywords)
            if not is_office_related and text and len(text.split()) > 5:
                logger.info("–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Ñ–∏—Å–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–∏ –≤ —Å—Ç—Ä–æ–≥–æ–º —Ä–µ–∂–∏–º–µ")
                return False

        return True
    
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –º–µ–º–∞: {e}")
        return False

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è
load_blocked_lists()
