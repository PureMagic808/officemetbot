#!/usr/bin/env python3
"""
–£–ª—É—á—à–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ä–µ–∫–ª–∞–º—ã.
–ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ª—é–±—ã—Ö —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤.
"""
import logging
import re
import os
import hashlib
from urllib.parse import urlparse
import json

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO,
                   format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')
logger = logging.getLogger(__name__)

# –ü—É—Ç–∏ –∫ —Ñ–∞–π–ª–∞–º –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–ø–∏—Å–∫–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
BLOCKED_IMAGES_CACHE = "blocked_images.json"
AD_SIGNATURES_CACHE = "ad_signatures.json"

# –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ö—ç—à–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
blocked_image_hashes = set()

# –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
ADVERTISING_PATTERNS = {
    "shopping": [
        "–∫—É–ø–∏—Ç—å", "–º–∞–≥–∞–∑–∏–Ω", "—Å–∫–∏–¥–∫", "–∑–∞–∫–∞–∂–∏", "–∑–∞–∫–∞–∂–∏—Ç–µ", "–∑–∞–∫–∞–∑–∞—Ç—å", 
        "–∞–∫—Ü–∏—è", "—Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞", "–±–µ—Å–ø–ª–∞—Ç–Ω", "–¥–µ—à–µ–≤–æ", "–≤—ã–≥–æ–¥–Ω–æ", 
        "—Ä–∞—Å—Å—Ä–æ—á–∫–∞", "—Ä—É–±", "‚ÇΩ", "$", "—Å–∫–∏–¥–∫", "sale", "shop", "–ø–æ–¥–∞—Ä–æ–∫", "–≤—ã–≥–æ–¥–∞",
        "–±–µ—Å–ø–ª–∞—Ç–Ω–æ", "—Ç–æ–≤–∞—Ä", "–¥–æ—Å—Ç–∞–≤–∫–∞", "–∫—É–ø–æ–Ω", "–ø—Ä–æ–º", "–ø—Ä–æ–º–æ", "promo",
        "–¥–∏—Å–∫–æ–Ω—Ç", "–ø–æ–∫—É–ø–∫", "–∑–∞–∫–∞–∑", "card", "–∫–∞—Ä—Ç–∞", "–±–∞–Ω–∫",
        "–ø—Ä–æ–º–æ–∫–æ–¥", "—Ç–æ–ª—å–∫–æ –¥–æ", "—É—Å–ø–µ–π"
    ],
    "fitness": [
        "—Ç—Ä–µ–Ω–µ—Ä", "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫", "—Ñ–∏—Ç–Ω–µ—Å", "—Å–ø–æ—Ä—Ç–∑–∞–ª", "–≥–∞–Ω—Ç–µ–ª–∏", "gym", 
        "workout", "—Ñ–∏—Ç–æ–Ω—è—à–∫–∞", "—Ñ–∏—Ç–Ω–µ—Å", "—Ç—Ä–µ–Ω–∞–∂–µ—Ä", "–∑–∞–ª", "—É–ø—Ä–∞–∂–Ω–µ–Ω", "–ø—Ä–µ—Å—Å", 
        "—Ñ–∏–≥—É—Ä", "—Ç–µ–ª–æ", "–ø–æ—Ö—É–¥–µ", "–¥–∏–µ—Ç–∞", "exercise", "fitness", 
        "–º—ã—à—Ü—ã", "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏", "—Ç—Ä–µ–Ω–∏—Ä—É–π—Å—è", "–∫–∞—Ä–¥–∏–æ", "–±–∞—Å—Å–µ–π–Ω", "–∞–∫–≤–∞–∞—ç—Ä–æ–±–∏–∫–∞",
        "–π–æ–≥–∞", "—Ä–∞—Å—Ç—è–∂–∫–∞", "–∫—Ä–æ—Å—Å—Ñ–∏—Ç", "crossfit", "—Ç—Ä–µ–Ω–∞–∂–µ—Ä", "–∞–±–æ–Ω–µ–º–µ–Ω—Ç",
        "stretching"
    ],
    "beauty": [
        "–º–∞–Ω–∏–∫—é—Ä", "–Ω–æ–≥—Ç–∏", "–ø–µ–¥–∏–∫—é—Ä", "—Å–∞–ª–æ–Ω", "nail", "beauty", 
        "–º–∞—Å—Ç–µ—Ä", "–ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä", "—Å—Ç—Ä–∏–∂–∫", "–æ–∫—Ä–∞—à–∏–≤–∞–Ω–∏–µ", "–≤–æ–ª–æ—Å—ã", "hair", "make up", 
        "makeup", "–≤–∏–∑–∞–∂", "–∫–æ—Å–º–µ—Ç–æ–ª–æ–≥", "–º–µ–π–∫–∞–ø", "lash", "lashes", "—Ä–µ—Å–Ω–∏—Ü—ã", 
        "–ø—Ä—è–¥—å", "–ø—Ä–∏—á–µ—Å–∫", "—Å—Ç–∏–ª–∏—Å—Ç", "—Å—Ç—Ä–∏–∂–∫", "—ç–ø–∏–ª—è—Ü–∏—è", "–º–∞—Å—Å–∞–∂",
        "–º–æ–ª–æ–¥–æ—Å—Ç—å", "anti-age", "–æ–º–æ–ª–æ–∂–µ–Ω–∏–µ", "spa", "—Å–ø–∞",
        "esthetic", "—ç—Å—Ç–µ—Ç–∏–∫"
    ],
    "food_delivery": [
        "–¥–æ—Å—Ç–∞–≤–∫–∞", "—Ä–æ–ª–ª—ã", "—Å—É—à–∏", "–ø–∏—Ü—Ü–∞", "—à–µ—Ñ", "–ø–æ–≤–∞—Ä", "—Ä–µ—Å—Ç–æ—Ä–∞–Ω", "–º–µ–Ω—é", 
        "–∫—É—Ö–Ω—è", "–∫–∞—Ñ–µ", "–µ–¥–∞", "–∑–∞–∫–∞–∑–∞—Ç—å –µ–¥—É", "–±–ª—é–¥–æ", "–≥–æ—Ç–æ–≤–∫–∞", "—Ä–µ—Ü–µ–ø—Ç", 
        "taste", "–≤–∫—É—Å", "sushi", "pizza", "chef", "food", "meal", 
        "–±–∏–∑–Ω–µ—Å-–ª–∞–Ω—á", "–±—É—Ä–≥–µ—Ä", "—Ñ–∞—Å—Ç—Ñ—É–¥", "—ç–∫—Å–ø—Ä–µ—Å—Å-–¥–æ—Å—Ç–∞–≤–∫–∞", 
        "—è–ø–æ–Ω—Å–∫–∞—è –∫—É—Ö–Ω—è", "–∫–∏—Ç–∞–π—Å–∫–∞—è –∫—É—Ö–Ω—è", "–∏—Ç–∞–ª—å—è–Ω—Å–∫–∞—è", "—Å—É—à–∏ —Å–µ—Ç", "—Ä–æ–ª–ª—ã —Å–µ—Ç",
        "—É–≥–æ—Ä—å", "–ª–æ—Å–æ—Å—å", "–¥–µ–ª–∏–∫–∞—Ç–µ—Å", "–≥–∞—Å—Ç—Ä–æ–Ω–æ–º", "–≤–æ–∫", "wok"
    ],
    "clothing": [
        "–æ–¥–µ–∂–¥–∞", "–æ–±—É–≤—å", "–ø–ª–∞—Ç—å–µ", "—Ñ—É—Ç–±–æ–ª–∫–∞", "–¥–∂–∏–Ω—Å—ã", "—é–±–∫–∞", 
        "–∫—É—Ä—Ç–∫–∞", "–ø–∞–ª—å—Ç–æ", "—à—É–±–∞", "—Å—É–º–∫–∞", "–∞–∫—Å–µ—Å—Å—É–∞—Ä", "fashion", "–º–æ–¥–∞", 
        "–±—Ä–µ–Ω–¥", "brand", "–∫–æ–ª–ª–µ–∫—Ü–∏—è", "clothes", "wear", 
        "–Ω–∞—Ä—è–¥", "–æ–±—Ä–∞–∑", "–ª—É–∫", "look", "shopping", 
        "—à–æ–ø–ø–∏–Ω–≥", "—Ç—Ä–µ–Ω–¥", "—Ç—Ä–µ–Ω–¥—ã", "–∞—É—Ç–ª–µ—Ç", "outlet", "sale", "—Å–µ–∑–æ–Ω"
    ],
    "real_estate": [
        "–Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å", "–∫–≤–∞—Ä—Ç–∏—Ä–∞", "—É—á–∞—Å—Ç–æ–∫", "–ø–æ–º–µ—â–µ–Ω–∏–µ", 
        "–∞—Ä–µ–Ω–¥–∞", "—Å–¥–∞–º", "—Å–¥–∞—é", "—Å–Ω–∏–º—É", "–ø—Ä–æ–¥–∞–º", "–ø—Ä–æ–¥–∞—é", "—Ä–∏—ç–ª—Ç–æ—Ä", 
        "–∑–∞—Å—Ç—Ä–æ–π—â–∏–∫", "–Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞", "—Ä–µ–º–æ–Ω—Ç", "–æ—Ç–¥–µ–ª–∫–∞", "–∏–ø–æ—Ç–µ–∫–∞", "–∫—Ä–µ–¥–∏—Ç", 
        "—Ä–∞—Å—Å—Ä–æ—á–∫–∞", "–∂–∏–ª–æ–π –∫–æ–º–ø–ª–µ–∫—Å", "–∂–∫", "–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã", "—Å—Ç—É–¥–∏—è",
        "real estate", "property", "flat", "rent", "mortgage", "credit"
    ],
    "education": [
        "–∫—É—Ä—Å—ã", "–æ–±—É—á–µ–Ω–∏–µ", "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "—Ç—Ä–µ–Ω–∏–Ω–≥", "—Å–µ–º–∏–Ω–∞—Ä", "–≤–µ–±–∏–Ω–∞—Ä", 
        "–º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å", "–º–∫", "school", "–∏–Ω—Å—Ç–∏—Ç—É—Ç", "—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç", 
        "–∫–æ–ª–ª–µ–¥–∂", "–∞–∫–∞–¥–µ–º–∏—è", "–Ω–∞–±–æ—Ä", "–ø—Ä–µ–ø–æ–¥", "—É—á–∏—Ç–µ–ª—å", "—É—á–µ–Ω–∏–∫", 
        "—Å—Ç—É–¥–µ–Ω—Ç", "–æ–Ω–ª–∞–π–Ω –∫—É—Ä—Å", "–¥–∏–ø–ª–æ–º", "—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç"
    ],
    "travel": [
        "–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ", "–æ—Ç–¥—ã—Ö", "–æ—Ç–µ–ª—å", "–≥–æ—Å—Ç–∏–Ω–∏—Ü–∞", "–±–∏–ª–µ—Ç—ã", "–∞–≤–∏–∞", 
        "—Å–∞–º–æ–ª–µ—Ç", "–ø–æ–µ–∑–¥", "–∫—Ä—É–∏–∑", "—ç–∫—Å–∫—É—Ä—Å–∏—è", "travel", "trip", "–∫—É—Ä–æ—Ä—Ç", 
        "–º–æ—Ä–µ", "–≥–æ—Ä—ã", "–ø–ª—è–∂", "beach", "sea", "–≥–æ—Ä—è—â–∏–µ —Ç—É—Ä—ã", "last minute", 
        "–≤–∏–∑–∞", "–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ", "booking", "all inclusive"
    ],
    "events": [
        "–∫–æ–Ω—Ü–µ—Ä—Ç", "—Ñ–µ—Å—Ç–∏–≤–∞–ª—å", "—à–æ—É", "–≤—ã—Å—Ç–∞–≤–∫–∞", "—Å–ø–µ–∫—Ç–∞–∫–ª—å", "–∫–∏–Ω–æ", "—Ç–µ–∞—Ç—Ä", 
        "–±–∏–ª–µ—Ç—ã", "–∞—Ñ–∏—à–∞", "event", "–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ", "–≤–µ—á–µ—Ä–∏–Ω–∫–∞", "party", 
        "–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è", "–ø—Ä–µ–º—å–µ—Ä–∞", "–æ—Ç–∫—Ä—ã—Ç–∏–µ", "–≥–∞–ª–∞", "—Ü–µ—Ä–µ–º–æ–Ω–∏—è", "–ø—Ä–∞–∑–¥–Ω–∏–∫"
    ]
}

# –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —à–∞–±–ª–æ–Ω—ã –≤ –æ–¥–∏–Ω —Å–ø–∏—Å–æ–∫
ALL_BLOCKED_PATTERNS = []
for category, patterns in ADVERTISING_PATTERNS.items():
    ALL_BLOCKED_PATTERNS.extend(patterns)

# –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
ALL_BLOCKED_PATTERNS = list(set(ALL_BLOCKED_PATTERNS))

# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É 
SPECIFIC_BLOCKED_IMAGES = [
    # –†–µ–∫–ª–∞–º–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
    # –§–∏—Ç–Ω–µ—Å
    "—Ç—Ä–µ–Ω–∏—Ä—É–π—Å—è-–≤–º–µ—Å—Ç–µ-—Å-–Ω–∞–º–∏", "train-with-us", "fitness-promo", "workout-ad",
    "—Ñ–∏—Ç–Ω–µ—Å-–∫–ª—É–±", "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞", "–≥–∞–Ω—Ç–µ–ª–∏", "fitness", "dumbbells", "exercise",
    "new-year-fitness", "–Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π-—Ñ–∏—Ç–Ω–µ—Å", "pink-dumbbells", "—Ä–æ–∑–æ–≤—ã–µ-–≥–∞–Ω—Ç–µ–ª–∏",
    # –ú–∞–Ω–∏–∫—é—Ä 
    "irina-emelyanova", "emelyanova-nail", "nail-artist", "–º–∞–Ω–∏–∫—é—Ä-–º–∞—Å—Ç–µ—Ä",
    "beauty-salon", "—Å–∞–ª–æ–Ω-–∫—Ä–∞—Å–æ—Ç—ã", "–º–∞–Ω–∏–∫—é—Ä", "–Ω–æ–≥—Ç–∏", "nail-design", "nail-art",
    # –ï–¥–∞
    "–¥–æ—Å—Ç–∞–≤–∫–∞-—Ä–æ–ª–ª–æ–≤", "sushi-delivery", "—á—Ç–æ—Ä—Ä—É", "–¥–æ—Å—Ç–∞–≤–∫–∞-—Å—É—à–∏", "—Å—É—à–∏-–¥–æ—Å—Ç–∞–≤–∫–∞",
    "—Ä–æ–ª–ª—ã-–¥–æ—Å—Ç–∞–≤–∫–∞", "–¥–æ—Å—Ç–∞–≤–∫–∞-–ø–∏—Ü—Ü—ã", "–¥–æ—Å—Ç–∞–≤–∫–∞-–µ–¥—ã", "–µ–¥–∞-–Ω–∞-–¥–æ–º", 
    "—Ä—ã–±–∞-–ø–æ–≤–∞—Ä", "—Ä—ã–±–∞-—à–µ—Ñ", "fish-chef", "chef-sushi",
    # –û–±—â–µ–µ
    "reklama", "—Ä–µ–∫–ª–∞–º–∞", "ad-", "advert-"
]

# –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
EXTENDED_MARKERS = {
    "fitness": [
        "—Ä–æ–∑–æ–≤—ã–µ –≥–∞–Ω—Ç–µ–ª–∏", "–Ω–æ–≤–æ–≥–æ–¥–Ω–∏–π", "—Ñ–∏—Ç–Ω–µ—Å", "—Å–ø–æ—Ä—Ç–∑–∞–ª", "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞",
        "—Ç—Ä–µ–Ω–∞–∂–µ—Ä", "—Ç—Ä–µ–Ω–∞–∂–µ—Ä–Ω—ã–π –∑–∞–ª", "–∞–±–æ–Ω–µ–º–µ–Ω—Ç", "–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–µ—Ä",
        "–≥—Ä—É–ø–ø–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏", "–∫—Ä–æ—Å—Å—Ñ–∏—Ç", "–∫–∞—Ä–¥–∏–æ", "—Å–∏–ª–æ–≤—ã–µ", "stretching"
    ],
    "nail_art": [
        "—Ä–æ–∑–æ–≤—ã–π —Ñ–æ–Ω", "–µ–º–µ–ª—å—è–Ω–æ–≤–∞", "–º–∞–Ω–∏–∫—é—Ä", "nail artist", "irina",
        "–¥–∏–∑–∞–π–Ω –Ω–æ–≥—Ç–µ–π", "nail master", "–º–∞—Å—Ç–µ—Ä –Ω–æ–≥—Ç–µ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞", "–ø–µ–¥–∏–∫—é—Ä",
        "–Ω–∞—Ä–∞—â–∏–≤–∞–Ω–∏–µ –Ω–æ–≥—Ç–µ–π", "–≥–µ–ª—å-–ª–∞–∫", "shellac", "—à–µ–ª–ª–∞–∫", "–º–∞–Ω–∏–∫—é—Ä–Ω—ã–π —Å–∞–ª–æ–Ω"
    ],
    "food_delivery": [
        "—Ä—ã–±–∞", "—à–µ—Ñ", "–ø–æ–≤–∞—Ä", "—Ä–æ–ª–ª—ã", "—Å—É—à–∏", "–¥–æ—Å—Ç–∞–≤–∫–∞", "—É–≥–æ—Ä—å", "—á—Ç–æ—Ä—Ä—É",
        "–ø–∏—Ü—Ü–∞", "–µ–¥–∞ –Ω–∞ –¥–æ–º", "—Å–∫–∏–¥–∫–∞ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É", "–±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞",
        "—è–ø–æ–Ω—Å–∫–∞—è –∫—É—Ö–Ω—è", "–∫–∏—Ç–∞–π—Å–∫–∞—è –∫—É—Ö–Ω—è", "–µ–≤—Ä–æ–ø–µ–π—Å–∫–∞—è –∫—É—Ö–Ω—è", "–∏—Ç–∞–ª—å—è–Ω—Å–∫–∞—è"
    ],
    "clothing": [
        "–Ω–æ–≤–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è", "—Å–∫–∏–¥–∫–∏ –¥–æ", "—Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞", "sale", "–º–æ–¥–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã",
        "—Å—Ç–∏–ª—å–Ω—ã–µ", "–±—Ä–µ–Ω–¥", "–¥–∏–∑–∞–π–Ω–µ—Ä", "–æ–¥–µ–∂–¥–∞", "–æ–±—É–≤—å", "–∞–∫—Å–µ—Å—Å—É–∞—Ä—ã",
        "—Å—É–º–∫–∏", "–ø–ª–∞—Ç—å—è", "–∫–æ—Å—Ç—é–º—ã", "premium", "–ª—é–∫—Å", "outlet"
    ],
    "real_estate": [
        "–Ω–æ–≤—ã–π –∂–∏–ª–æ–π –∫–æ–º–ø–ª–µ–∫—Å", "–∫–≤–∞—Ä—Ç–∏—Ä—ã –æ—Ç –∑–∞—Å—Ç—Ä–æ–π—â–∏–∫–∞", "–∏–ø–æ—Ç–µ–∫–∞", "—Ä–∞—Å—Å—Ä–æ—á–∫–∞",
        "–ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –≤–∑–Ω–æ—Å", "–Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞", "–∂–∏–ª–æ–π –∫–æ–º–ø–ª–µ–∫—Å", "–∞–ø–∞—Ä—Ç–∞–º–µ–Ω—Ç—ã",
        "–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å", "–æ—Ñ–∏—Å—ã", "–≤—ã–≥–æ–¥–Ω—ã–µ —É—Å–ª–æ–≤–∏—è", "—Å–∫–∏–¥–∫–∞"
    ]
}

def load_blocked_lists():
    """–ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–æ–≤"""
    global blocked_image_hashes
    
    try:
        if os.path.exists(BLOCKED_IMAGES_CACHE):
            with open(BLOCKED_IMAGES_CACHE, 'r', encoding='utf-8') as f:
                loaded_hashes = json.load(f)
                if loaded_hashes and isinstance(loaded_hashes, list):
                    blocked_image_hashes = set(loaded_hashes)
                    logger.info(f"–ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(blocked_image_hashes)} —Ö—ç—à–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤: {e}")

def save_blocked_lists():
    """–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–ø–∏—Å–∫–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ —Ñ–∞–π–ª—ã"""
    try:
        with open(BLOCKED_IMAGES_CACHE, 'w', encoding='utf-8') as f:
            json.dump(list(blocked_image_hashes), f, ensure_ascii=False, indent=2)
        logger.info(f"–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ {len(blocked_image_hashes)} —Ö—ç—à–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–æ–≤ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤: {e}")

def compute_image_hash(image_url):
    """–í—ã—á–∏—Å–ª—è–µ—Ç —Ö—ç—à –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ URL"""
    return hashlib.md5(image_url.encode()).hexdigest()

def add_blocked_image(image_url):
    """–î–æ–±–∞–≤–ª—è–µ—Ç URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Å–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö"""
    if not image_url:
        return
    
    image_hash = compute_image_hash(image_url)
    blocked_image_hashes.add(image_hash)
    save_blocked_lists()
    logger.info(f"–î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: {image_url[:50]}...")

def is_blocked_image(image_url):
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ URL"""
    if not image_url:
        return False
    
    image_hash = compute_image_hash(image_url)
    return image_hash in blocked_image_hashes

def detect_advertisement_in_text(text):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (bool, str) - (–Ω–∞–π–¥–µ–Ω–∞ —Ä–µ–∫–ª–∞–º–∞?, –ø—Ä–∏—á–∏–Ω–∞)
    """
    if not text:
        return False, ""
    
    text = text.lower()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Ñ—Ä–∞–∑—ã
    for pattern in ALL_BLOCKED_PATTERNS:
        if pattern.lower() in text:
            return True, f"–Ω–∞–π–¥–µ–Ω–æ —Ä–µ–∫–ª–∞–º–Ω–æ–µ —Å–ª–æ–≤–æ '{pattern}'"
    
    # –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤
    ad_regexes = [
        # –°–∫–∏–¥–∫–∏, –ø—Ä–æ—Ü–µ–Ω—Ç—ã
        r'\d+\s*%',  # 50%, 20 %, etc.
        r'—Å–∫–∏–¥–∫[–∞–∏—É]?\s+–¥–æ\s+\d+',  # —Å–∫–∏–¥–∫–∞ –¥–æ 50
        r'–¥–æ\s+-\d+\s*%',  # –¥–æ -50%
        r'–æ—Ç\s+\d+\s*—Ä—É–±',  # –æ—Ç 100 —Ä—É–±
        r'–≤—Å–µ–≥–æ\s+\d+\s*—Ä—É–±',  # –≤—Å–µ–≥–æ 100 —Ä—É–±
        r'–≤—Å–µ–≥–æ\s+–∑–∞\s+\d+', # –≤—Å–µ–≥–æ –∑–∞ 100
        r'—Ü–µ–Ω–∞\s*:?\s*\d+',  # —Ü–µ–Ω–∞: 100
        r'—Å—Ç–æ–∏–º–æ—Å—Ç—å\s*:?\s*\d+',  # —Å—Ç–æ–∏–º–æ—Å—Ç—å: 100
        r'—Ä—É–±\.|‚ÇΩ',  # —Ä—É–±. –∏–ª–∏ —Å–∏–º–≤–æ–ª —Ä—É–±–ª—è
        
        # –†–µ–∫–ª–∞–º–Ω—ã–µ –ø—Ä–∏–∑—ã–≤—ã
        r'–∑–≤–æ–Ω–∏[—Ç–µ]?',  # –∑–≤–æ–Ω–∏, –∑–≤–æ–Ω–∏—Ç–µ
        r'–ø–∏—à–∏[—Ç–µ]?',  # –ø–∏—à–∏, –ø–∏—à–∏—Ç–µ
        r'–∑–∞—Ö–æ–¥–∏[—Ç–µ]?',  # –∑–∞—Ö–æ–¥–∏, –∑–∞—Ö–æ–¥–∏—Ç–µ
        r'–ø—Ä–∏—Ö–æ–¥–∏[—Ç–µ]?',  # –ø—Ä–∏—Ö–æ–¥–∏, –ø—Ä–∏—Ö–æ–¥–∏—Ç–µ
        r'—Å–ø–µ—à–∏[—Ç–µ]?',  # —Å–ø–µ—à–∏, —Å–ø–µ—à–∏—Ç–µ
        r'—É—Å–ø–µ–π[—Ç–µ]?',  # —É—Å–ø–µ–π, —É—Å–ø–µ–π—Ç–µ
        r'–∑–∞–∫–∞–∂–∏[—Ç–µ]?',  # –∑–∞–∫–∞–∂–∏, –∑–∞–∫–∞–∂–∏—Ç–µ
        r'–ø—Ä–µ–¥–ª–æ–∂[–µ–∏]–Ω–∏[–µ—è]',  # –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        r'–≤—ã–≥–æ–¥–Ω[—ã–æ–µ–∞—è]',  # –≤—ã–≥–æ–¥–Ω—ã–π, –≤—ã–≥–æ–¥–Ω–æ, –≤—ã–≥–æ–¥–Ω–∞—è
        r'–ø–æ–¥—Ä–æ–±–Ω[–µ–µ]?',  # –ø–æ–¥—Ä–æ–±–Ω–µ–µ

        # –¢–µ–ª–µ—Ñ–æ–Ω—ã –∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã
        r'\+7\s*\(\d{3}\)\s*\d{3}[-\s]?\d{2}[-\s]?\d{2}',  # +7(123)456-78-90
        r'8\s*\d{3}[-\s]?\d{3}[-\s]?\d{2}[-\s]?\d{2}',  # 8 123 456 78 90
        r'—Ç–µ–ª[\.\:]',  # —Ç–µ–ª. –∏–ª–∏ —Ç–µ–ª:
        r'–∫–æ–Ω—Ç–∞–∫—Ç—ã\s*:',  # –∫–æ–Ω—Ç–∞–∫—Ç—ã:
        
        # –°—Å—ã–ª–∫–∏ –∏ –æ–Ω–ª–∞–π–Ω-–º–∞—Ä–∫–µ—Ä—ã
        r'https?:\/\/',  # http:// –∏–ª–∏ https://
        r'www\.',  # www.
        r'\.ru|\.com|\.net|\.org',  # .ru, .com, –∏ —Ç.–¥.
        r'–æ–Ω–ª–∞–π–Ω',  # –æ–Ω–ª–∞–π–Ω
        r'–æ—Ñ+–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç',  # –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç
        r'–ø–æ–¥–ø–∏—Å—ã–≤–∞[–µ—è]—Ç–µ—Å—å',  # –ø–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å, –ø–æ–¥–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å
        r'–∑–∞–∫–∞–∑[–∞—Ç]—å\s+–Ω–∞\s+—Å–∞–π—Ç–µ',  # –∑–∞–∫–∞–∑–∞—Ç—å –Ω–∞ —Å–∞–π—Ç–µ
        
        # –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã
        r'–∞–∫—Ü–∏[—è–∏]',  # –∞–∫—Ü–∏—è, –∞–∫—Ü–∏–∏
        r'—Å–∫–∏–¥–∫[–∏–∞]',  # —Å–∫–∏–¥–∫–∏, —Å–∫–∏–¥–∫–∞
        r'—Ä–∞—Å–ø—Ä–æ–¥–∞–∂[–∞–∏]',  # —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∞, —Ä–∞—Å–ø—Ä–æ–¥–∞–∂–∏
        r'—Å–ø–µ—Ü\.?\s*–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏[–µ—è]',  # —Å–ø–µ—Ü.–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, —Å–ø–µ—Ü –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        r'–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ',  # –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ
        r'—Ç–æ–ª—å–∫–æ\s+(—Å–µ–≥–æ–¥–Ω—è|–∑–∞–≤—Ç—Ä–∞|–¥–æ\s+\d+)',  # —Ç–æ–ª—å–∫–æ —Å–µ–≥–æ–¥–Ω—è, —Ç–æ–ª—å–∫–æ –¥–æ 10
        r'–¥–µ–π—Ç—Å–≤—É[–µ—é—è]—Ç\s+–¥–æ',  # –¥–µ–π—Å—Ç–≤—É–µ—Ç –¥–æ
        r'–∑–∞–ø–∏—Å—ã–≤–∞[–µ–π]—Ç–µ—Å—å',  # –∑–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å, –∑–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ—Å—å
        r'–ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏\s+(–ø–æ\s+—Ç–µ–ª–µ—Ñ–æ–Ω—É|–Ω–∞\s+—Å–∞–π—Ç–µ)',  # –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É, –Ω–∞ —Å–∞–π—Ç–µ
        
        # –≠–º–æ–¥–∑–∏, –∫–æ—Ç–æ—Ä—ã–µ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ä–µ–∫–ª–∞–º–µ
        r'üí∞|üí≤|üí∏|üíµ|üí¥|üí∂|üí∑',  # –¥–µ–Ω—å–≥–∏
        r'üè∑Ô∏è|üè∑|üîñ|üìù',  # —Ü–µ–Ω–Ω–∏–∫–∏, –±–∏—Ä–∫–∏
        r'üì≤|üì±|üìû|‚òéÔ∏è|üìß|‚úâÔ∏è',  # —Ç–µ–ª–µ—Ñ–æ–Ω—ã, –∫–æ–Ω—Ç–∞–∫—Ç—ã
        r'üõí|üõçÔ∏è|üõç|üéÅ',  # –ø–æ–∫—É–ø–∫–∏, –ø–æ–¥–∞—Ä–∫–∏
    ]
    
    for regex in ad_regexes:
        match = re.search(regex, text, re.IGNORECASE)
        if match:
            return True, f"–Ω–∞–π–¥–µ–Ω —Ä–µ–∫–ª–∞–º–Ω—ã–π —à–∞–±–ª–æ–Ω '{match.group(0)}'"
    
    return False, ""

def detect_advertisement_in_url(url):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç URL –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (bool, str) - (–Ω–∞–π–¥–µ–Ω–∞ —Ä–µ–∫–ª–∞–º–∞?, –ø—Ä–∏—á–∏–Ω–∞)
    """
    if not url:
        return False, ""
    
    url = url.lower()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    for specific_image in SPECIFIC_BLOCKED_IMAGES:
        if specific_image.lower() in url:
            return True, f"URL —Å–æ–¥–µ—Ä–∂–∏—Ç –±–ª–æ–∫–∏—Ä—É–µ–º—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: {specific_image}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ª–∏ URL –≤ —Å–ø–∏—Å–∫–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
    if is_blocked_image(url):
        return True, "URL –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ–º–µ–Ω –∏ –ø—É—Ç—å –Ω–∞ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
    parsed_url = urlparse(url)
    domain_path = (parsed_url.netloc + parsed_url.path).lower()
    
    for pattern in ALL_BLOCKED_PATTERNS:
        if pattern.lower() in domain_path:
            return True, f"URL —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∫–ª–∞–º–Ω–æ–µ —Å–ª–æ–≤–æ: {pattern}"
    
    return False, ""

def detect_ad_category(item_data):
    """
    –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä–µ–∫–ª–∞–º—ã, –µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Ö–æ–∂ –Ω–∞ —Ä–µ–∫–ª–∞–º—É
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (–∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–ª–∏ None, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å 0-100)
    """
    if not item_data:
        return None, 0
    
    text = item_data.get("text", "").lower() if "text" in item_data else ""
    image_url = item_data.get("image_url", "").lower() if "image_url" in item_data else ""
    
    category_scores = {}
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—Å—Ç –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
    for category, patterns in ADVERTISING_PATTERNS.items():
        score = 0
        for pattern in patterns:
            pattern_count = text.count(pattern)
            if pattern_count > 0:
                score += pattern_count * 10  # –ë–∞–∑–æ–≤—ã–π –≤–µ—Å –∫–∞–∂–¥–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
        
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤
        if category in EXTENDED_MARKERS:
            for marker in EXTENDED_MARKERS[category]:
                if marker in text:
                    score += 15  # –ë–æ–ª—å—à–∏–π –≤–µ—Å –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –º–∞—Ä–∫–µ—Ä–æ–≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ URL –Ω–∞ –º–∞—Ä–∫–µ—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        for pattern in patterns:
            if pattern in image_url:
                score += 5  # –ú–µ–Ω—å—à–∏–π –≤–µ—Å –¥–ª—è —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π –≤ URL
        
        category_scores[category] = score
    
    # –ù–∞–π—Ç–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º —Å—á–µ—Ç–æ–º
    max_category = max(category_scores.items(), key=lambda x: x[1]) if category_scores else (None, 0)
    
    # –í–µ—Ä–Ω—É—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é, —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—á–µ—Ç –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
    if max_category[1] >= 10:
        confidence = min(max_category[1], 100)  # –û–±—Ä–µ–∑–∞–µ–º –¥–æ 100%
        return max_category[0], confidence
    
    return None, 0

def check_for_specific_ad_content(image_url, text=None):
    """
    –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (bool, str) - (—è–≤–ª—è–µ—Ç—Å—è —Ä–µ–∫–ª–∞–º–Ω—ã–º?, –ø—Ä–∏—á–∏–Ω–∞)
    """
    if not image_url and not text:
        return False, ""
    
    url = image_url.lower() if image_url else ""
    text_content = text.lower() if text else ""
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏ –∏ —Ñ–∏—Ç–Ω–µ—Å–æ–º
    for marker in EXTENDED_MARKERS["fitness"]:
        if marker in url or marker in text_content:
            return True, f"–æ–±–Ω–∞—Ä—É–∂–µ–Ω –º–∞—Ä–∫–µ—Ä —Ñ–∏—Ç–Ω–µ—Å-—Ä–µ–∫–ª–∞–º—ã: {marker}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–∫–ª–∞–º—É –º–∞–Ω–∏–∫—é—Ä–∞ –∏ nail artist
    for marker in EXTENDED_MARKERS["nail_art"]:
        if marker in url or marker in text_content:
            return True, f"–æ–±–Ω–∞—Ä—É–∂–µ–Ω –º–∞—Ä–∫–µ—Ä —Ä–µ–∫–ª–∞–º—ã –º–∞–Ω–∏–∫—é—Ä–∞: {marker}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–æ—Å—Ç–∞–≤–∫—É –µ–¥—ã
    for marker in EXTENDED_MARKERS["food_delivery"]:
        if marker in url or marker in text_content:
            return True, f"–æ–±–Ω–∞—Ä—É–∂–µ–Ω –º–∞—Ä–∫–µ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏ –µ–¥—ã: {marker}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–¥–µ–∂–¥—É –∏ –º–∞–≥–∞–∑–∏–Ω—ã
    for marker in EXTENDED_MARKERS["clothing"]:
        if marker in url or marker in text_content:
            return True, f"–æ–±–Ω–∞—Ä—É–∂–µ–Ω –º–∞—Ä–∫–µ—Ä –º–∞–≥–∞–∑–∏–Ω–∞ –æ–¥–µ–∂–¥—ã: {marker}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å
    for marker in EXTENDED_MARKERS["real_estate"]:
        if marker in url or marker in text_content:
            return True, f"–æ–±–Ω–∞—Ä—É–∂–µ–Ω –º–∞—Ä–∫–µ—Ä —Ä–µ–∫–ª–∞–º—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏: {marker}"
    
    return False, ""

def is_suitable_meme_advanced(meme):
    """
    –£—Å–æ–≤–µ—Ä—à–µ–Ω—Å—Ç–≤–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞, –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –º–µ–º –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤—ã–≤–∞–µ—Ç –≤—Å–µ –≤–∏–¥—ã —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–º –æ–±—Ä–∞–∑–æ–º.
    
    Args:
        meme (dict): –°–ª–æ–≤–∞—Ä—å —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–µ–º–µ (—Ç–µ–∫—Å—Ç, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, —Ç–µ–≥–∏ –∏ —Ç.–¥.)
        
    Returns:
        bool: True –µ—Å–ª–∏ –º–µ–º –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ–∫–∞–∑–∞, False –µ—Å–ª–∏ –Ω–µ—Ç
    """
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
    if not blocked_image_hashes:
        load_blocked_lists()
    
    try:
        # –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –º–µ–º–∞
        image_url = meme.get("image_url", "").lower() if "image_url" in meme else ""
        text = meme.get("text", "").lower() if "text" in meme else ""
        
        # –ê–ì–†–ï–°–°–ò–í–ù–ê–Ø –§–ò–õ–¨–¢–†–ê–¶–ò–Ø: –µ—Å–ª–∏ —Ç–µ–∫—Å—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π
        if not text or len(text.split()) < 3:
            logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç (–º–µ–Ω–µ–µ 3 —Å–ª–æ–≤)")
            return False
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç (–Ω–µ —Å–≤—è–∑–∞–Ω —Å –æ—Ñ–∏—Å–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–æ–π)
        religious_keywords = [
            "—Ö—Ä–∏—Å—Ç–∏–∞–Ω—Å–∫", "—Å–ª—É–∂–µ–Ω–∏", "–ø—Ä–∞–≤–æ—Å–ª–∞–≤", "–º–æ–ª–∏—Ç–≤", "—Ü–µ—Ä–∫–æ–≤—å", "—Ö—Ä–∞–º",
            "–±–æ–≥", "–≥–æ—Å–ø–æ–¥", "–≤–µ—Ä–∞", "–¥—É—Ö–æ–≤–Ω", "—Ä–µ–ª–∏–≥–∏", "—Å–≤—è—Ç–æ–π", "—Å–≤—è—â–µ–Ω–Ω–∏–∫",
            "–ø—Ä–æ–ø–æ–≤–µ–¥", "–±–∏–±–ª–∏", "–∫—Ä–µ—â–µ–Ω–∏", "–≥—Ä–µ—Ö", "–∏—Å–ø–æ–≤–µ–¥", "–≤–æ—Å–∫—Ä–µ—Å–µ–Ω–∏",
            "—Ü–µ—Ä–µ–º–æ–Ω–∏", "—Ä–∏—Ç—É–∞–ª", "–ø–æ–∫–ª–æ–Ω–µ–Ω–∏", "–ø–∞—Ç—Ä–∏–∞—Ä—Ö", "–º–æ–Ω–∞—Å—Ç—ã", "–º–æ–Ω–∞—Ö"
        ]
        
        # –ï—Å–ª–∏ –≤ —Ç–µ–∫—Å—Ç–µ –µ—Å—Ç—å —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ —Ç–µ–º—ã, —ç—Ç–æ –Ω–µ –æ—Ñ–∏—Å–Ω—ã–π —é–º–æ—Ä
        for keyword in religious_keywords:
            if keyword in text:
                logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–ª–∏–≥–∏–æ–∑–Ω—É—é —Ç–µ–º–∞—Ç–∏–∫—É ('{keyword}')")
                return False
                
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ –º—É–∂—á–∏–Ω —Å —Ç–∞—Ç—É–∏—Ä–æ–≤–∫–∞–º–∏ (–Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ç–µ–º—ã)
        tattoo_keywords = ["—Ç–∞—Ç—É", "—Ç–∞—Ç—É–∏—Ä–æ–≤–∫", "—Ç–∞—Ç—É—Ö–∞", "–Ω–∞–±–∏—Ç", "–Ω–∞–±–∏–≤–∞—Ç—å"]
        for keyword in tattoo_keywords:
            if keyword in text:
                logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: —Å–æ–¥–µ—Ä–∂–∏—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ç–∞—Ç—É–∏—Ä–æ–≤–æ–∫")
                return False
        
        # –ü–µ—Ä–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä–∫–∏: –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Ç–µ–∫—Å—Ç
        is_ad, reason = check_for_specific_ad_content(image_url, text)
        if is_ad:
            logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: {reason}")
            return False
        
        # –í—Ç–æ—Ä–æ–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä–∫–∏: —Ç–µ–∫—Å—Ç –º–µ–º–∞ (–±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π)
        is_ad, reason = detect_advertisement_in_text(text)
        if is_ad:
            logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ —Ç–µ–∫—Å—Ç—É ({reason})")
            return False
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ –º–µ–º–∞
        # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –æ—Ñ–∏—Å–Ω—ã–º —é–º–æ—Ä–æ–º –∏ —Ä–∞–±–æ—Ç–æ–π
        office_keywords = [
            "–æ—Ñ–∏—Å", "—Ä–∞–±–æ—Ç–∞", "–±–æ—Å—Å", "–Ω–∞—á–∞–ª—å–Ω–∏–∫", "–∫–æ–ª–ª–µ–≥–∞", "–∫–æ–ª–ª–µ–≥–∏", 
            "—Å–æ—Ç—Ä—É–¥–Ω–∏–∫", "–ø—Ä–æ–µ–∫—Ç", "–æ—Ç–ø—É—Å–∫", "–∑–∞—Ä–ø–ª–∞—Ç–∞", "–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫",
            "—Å–æ–≤–µ—â–∞–Ω–∏–µ", "—Å–æ–±—Ä–∞–Ω–∏–µ", "–¥–µ–¥–ª–∞–π–Ω", "—Å—Ä–æ–∫", "–ø—è—Ç–Ω–∏—Ü–∞", "–≤—ã—Ö–æ–¥–Ω–æ–π",
            "—á–∞—Ç", "–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤", "–ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è", "–æ—Ç—á–µ—Ç", "–∫–æ—Ñ–µ", "–ø–µ—Ä–µ—Ä—ã–≤",
            "–∫–∞–±–∏–Ω–µ—Ç", "—Å—Ç–æ–ª", "–∫–æ–º–ø—å—é—Ç–µ—Ä", "–¥–æ–∫—É–º–µ–Ω—Ç", "–ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç",
            "–º–µ–Ω–µ–¥–∂–µ—Ä", "–æ—Ç–¥–µ–ª", "—É–≤–æ–ª—å–Ω–µ–Ω–∏–µ", "—Å—Ç–∞–≤–∫–∞", "—Ä–µ–∑—é–º–µ", "–≤–∞–∫–∞–Ω—Å–∏—è",
            "–¥–æ–ª–∂–Ω–æ—Å—Ç—å", "–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å", "—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å", "–±—É–¥–∏–ª—å–Ω–∏–∫",
            "–æ–ø–æ–∑–¥–∞–Ω–∏–µ", "–æ–±–µ–¥", "–æ–±–µ–¥–µ–Ω–Ω—ã–π –ø–µ—Ä–µ—Ä—ã–≤", "–ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞", "–∫–æ–º–∞–Ω–¥–∞",
            "–±–∏–∑–Ω–µ—Å", "–∫–ª–∏–µ–Ω—Ç", "—Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å", "–¥–∏—Ä–µ–∫—Ç–æ—Ä", "–∑–∞–¥–∞—á–∞", "–ø—Ä–∏–∫–∞–∑",
            "—Ñ–∏–Ω–∞–Ω—Å—ã", "–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã", "—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ", "—Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å", "—Å–º–µ–Ω–∞", "–±—É—Ö–≥–∞–ª—Ç–µ—Ä"
        ]
        
        work_keywords = [
            "—Ä–∞–±–æ—Ç–∞—Ç—å", "—Ç—Ä—É–¥–∏—Ç—å—Å—è", "—Ä–∞–±–æ—Ç–∞—é", "—Ä–∞–±–æ—Ç–∞–µ–º", "–¥–æ–º–æ–π", "—Å–∏–∂—É", "—Å–∏–¥–∏–º",
            "—Ä–∞–±–æ—á–∏–π", "–æ—Ñ–∏—Å–Ω—ã–π", "—É—Å—Ç–∞–ª", "–Ω–µ –≤—ã—Å–ø–∞–ª—Å—è", "–∫–æ–º–ø–∞–Ω–∏—è", "–∫–æ—Ä–ø–æ—Ä–∞—Ü–∏—è",
            "—Ñ–∏—Ä–º–∞", "–∑–∞—Ä–ø–ª–∞—Ç—É", "–ø–æ–≤—ã—à–µ–Ω–∏–µ", "–∞–≤–∞–Ω—Å", "–ø—Ä–µ–º–∏—è", "–æ—Ç–≥—É–ª", "–≤—ã–≥–æ–≤–æ—Ä", 
            "–ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã", "–±—É–º–∞–≥–∏", "–ø—Ä–∏–¥—É–º–∞—Ç—å", "—É—Å–ø–µ—Ç—å", "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å", "–ø—Ä–∏—ë–º", 
            "–ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å", "–∫–æ–º–∞–Ω–¥–∏—Ä–æ–≤–∫–∞", "–∑–≤–æ–Ω–æ–∫", "–≥—Ä–∞—Ñ–∏–∫", "–ø–æ—á—Ç–∞", "email",
            "–≤—ã—Ö–æ–¥–Ω—ã–µ", "–±—É–¥–Ω–∏", "—Å—Ç—Ä–µ—Å—Å", "–ø—Ä–æ—Ñ–µ—Å—Å–∏—è", "–∫–∞—Ä—å–µ—Ä–∞"
        ]
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –æ—Ñ–∏—Å–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–∏
        def check_is_office_related(text):
            text_lower = text.lower()
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —Å–ª–æ–≤
            for keyword in office_keywords:
                if keyword in text_lower.split():
                    return True, keyword
                
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ —Å–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–∫—Å—Ç–∞
            for keyword in office_keywords:
                if keyword in text_lower:
                    return True, keyword
                    
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Ö–æ–∂–¥–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –≥–ª–∞–≥–æ–ª–æ–≤ –∏ –ø—Ä–∏–ª–∞–≥–∞—Ç–µ–ª—å–Ω—ã—Ö
            for keyword in work_keywords:
                if keyword in text_lower:
                    return True, keyword
            
            return False, ""
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–≤—è–∑–∞–Ω –ª–∏ –∫–æ–Ω—Ç–µ–Ω—Ç —Å –æ—Ñ–∏—Å–Ω–æ–π —Ç–µ–º–∞—Ç–∏–∫–æ–π
        is_office_related, found_keyword = check_is_office_related(text)
        
        # –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –æ—Ñ–∏—Å–Ω—ã–π —é–º–æ—Ä, –æ—Ç–∫–ª–æ–Ω—è–µ–º –º–µ–º
        if not is_office_related:
            logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: —Ç–µ–∫—Å—Ç –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –ø–æ —Ç–µ–º–∞—Ç–∏–∫–µ –æ—Ñ–∏—Å–∞/—Ä–∞–±–æ—Ç—ã")
            return False
        
        # –¢—Ä–µ—Ç–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä–∫–∏: URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        if image_url:
            is_ad, reason = detect_advertisement_in_url(image_url)
            if is_ad:
                logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ URL ({reason})")
                return False
                
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ –≤–∞–ª—é—Ç –≤ —Ç–µ–∫—Å—Ç–µ (‚ÇΩ, $, ‚Ç¨, —Ä—É–±)
        currency_symbols = ["‚ÇΩ", "$", "‚Ç¨", "—Ä—É–±", "—Ä—É–±–ª", "dollar", "–¥–æ–ª–ª–∞—Ä", "–µ–≤—Ä–æ"]
        if any(symbol in text for symbol in currency_symbols):
            logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–º–≤–æ–ª—ã –≤–∞–ª—é—Ç/–¥–µ–Ω–µ–≥")
            return False
        
        # –ß–µ—Ç–≤–µ—Ä—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä–∫–∏: —Ç–µ–≥–∏
        if "tags" in meme and isinstance(meme["tags"], list):
            # –°–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å —Ä–µ–∫–ª–∞–º–Ω—ã–º–∏
            allowed_tags = ["–æ—Ñ–∏—Å", "—Ä–∞–±–æ—Ç–∞", "–æ—Ñ—Ñ–∏—Å", "–±–æ—Å—Å", "–Ω–∞—á–∞–ª—å–Ω–∏–∫", "–∫–æ–ª–ª–µ–≥–∏", "—Å–æ—Ç—Ä—É–¥–Ω–∏–∫"]
            
            # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –ø—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–µ–≥ –∏–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö
            has_allowed_tag = False
            for tag in meme["tags"]:
                if tag.lower() in allowed_tags:
                    has_allowed_tag = True
                    break
                    
            # –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–≥–æ —Ç–µ–≥–∞ –∏ –ø—Ä–∏ —ç—Ç–æ–º —Ç–µ–∫—Å—Ç –∫–æ—Ä–æ—Ç–∫–∏–π - —ç—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ
            if not has_allowed_tag and text and len(text.split()) < 15:
                logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: –Ω–µ –∏–º–µ–µ—Ç —Ç–µ–≥–æ–≤ –ø–æ —Ç–µ–º–∞—Ç–∏–∫–µ –æ—Ñ–∏—Å–∞")
                return False
            
            for tag in meme["tags"]:
                tag_text = tag.lower()
                
                # –ï—Å–ª–∏ —Ç–µ–≥ –≤ —Å–ø–∏—Å–∫–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –µ–≥–æ
                if tag_text in allowed_tags:
                    continue
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–≥–æ–≤ –Ω–∞ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
                is_ad, reason = detect_advertisement_in_text(tag_text)
                if is_ad:
                    logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ —Ç–µ–≥—É: {tag} ({reason})")
                    return False
        
        # –ü—è—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≤–µ—Ä–∫–∏: –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ 
        if "metadata" in meme and isinstance(meme["metadata"], dict):
            metadata = meme["metadata"]
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
            if "title" in metadata and metadata["title"]:
                is_ad, reason = detect_advertisement_in_text(metadata["title"])
                if is_ad:
                    logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö ({reason})")
                    return False
            
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è
            if "description" in metadata and metadata["description"]:
                is_ad, reason = detect_advertisement_in_text(metadata["description"])
                if is_ad:
                    logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö ({reason})")
                    return False
        
        # –®–µ—Å—Ç–æ–π —É—Ä–æ–≤–µ–Ω—å: –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–µ–∫–ª–∞–º—ã (—Å –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–º –ø–æ—Ä–æ–≥–æ–º)
        ad_category, confidence = detect_ad_category(meme)
        if ad_category and confidence > 20:  # –ü–æ–Ω–∏–∑–∏–ª–∏ –ø–æ—Ä–æ–≥ —Å 30% –¥–æ 20%
            logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: –ø–æ—Ö–æ–∂ –Ω–∞ —Ä–µ–∫–ª–∞–º—É –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ '{ad_category}' —Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é {confidence}%")
            return False
            
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –±–µ–∑ —Å–º—ã—Å–ª–∞
        if text and len(text.split()) > 50:
            # –î–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã —á–∞—Å—Ç–æ –±—ã–≤–∞—é—Ç —Å–ø–∞–º–æ–º –∏–ª–∏ —Ä–µ–∫–ª–∞–º–æ–π
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö —Å–ª–æ–≤ –∏–ª–∏ —Ñ—Ä–∞–∑
            words = text.split()
            word_count = {}
            for word in words:
                if len(word) > 3:  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–ª–æ–≤–∞
                    word_count[word] = word_count.get(word, 0) + 1
                    
            # –ï—Å–ª–∏ –∫–∞–∫–æ–µ-—Ç–æ —Å–ª–æ–≤–æ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –±–æ–ª–µ–µ 5 —Ä–∞–∑, —ç—Ç–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ
            for word, count in word_count.items():
                if count > 5:
                    logger.info(f"–ú–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω: —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–µ–µ—Å—è —Å–ª–æ–≤–æ '{word}' ({count} —Ä–∞–∑)")
                    return False
        
        # –ï—Å–ª–∏ –ø—Ä–æ—à–µ–ª –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏, –∑–Ω–∞—á–∏—Ç –º–µ–º –ø–æ–¥—Ö–æ–¥–∏—Ç
        return True
    
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –º–µ–º–∞: {e}")
        # –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –ª—É—á—à–µ —Å—á–∏—Ç–∞—Ç—å, —á—Ç–æ –º–µ–º –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç
        return False

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
load_blocked_lists()